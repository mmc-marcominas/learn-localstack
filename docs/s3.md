# AWS S3 Service Guide

This guide demonstrates how to use Amazon S3 (Simple Storage Service) with LocalStack for object storage operations.

## üéØ Overview

Amazon S3 provides scalable object storage in the cloud. This guide covers essential S3 operations including bucket creation, object management, and URL generation.

## üöÄ Getting Started

### Prerequisites

- LocalStack running with S3 service enabled
- AWS CLI configured for LocalStack (`awslocal` command)
- `jq` for JSON formatting (optional)

### Service Configuration

Ensure S3 is enabled in your `docker-compose.yml`:

```yaml
environment:
  SERVICES: 'sqs,s3,sns,dynamodb,kms,route53'
```

## üìã Core Operations

### 1. Bucket Management

#### Create a Bucket

```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3api create-bucket --bucket my-app-storage --region us-east-1
```

**Expected Response:**
```json
{
    "Location": "/my-app-storage"
}
```

#### List All Buckets

```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3api list-buckets | jq
```

**Expected Response:**
```json
{
    "Buckets": [
        {
            "Name": "my-app-storage",
            "CreationDate": "2024-10-20T18:47:02.000Z"
        }
    ],
    "Owner": {
        "DisplayName": "webfile",
        "ID": "75aa57f09aa0c8caeab4f8c24e99d10f8e7faeebf76c078efc7c6caea54ba06a"
    }
}
```

### 2. Object Operations

#### Upload Objects

Upload a configuration file:
```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3api put-object \
    --bucket my-app-storage \
    --key config/env-settings \
    --body env-settings
```

Upload a license file:
```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3api put-object \
    --bucket my-app-storage \
    --key legal/license \
    --body LICENSE
```

**Expected Response:**
```json
{
    "ETag": "\"c2aab1ab21f660fc58c29461ed04fec4\"",
    "ServerSideEncryption": "AES256"
}
```

#### List Objects in Bucket

```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3api list-objects --bucket my-app-storage | jq
```

**Expected Response:**
```json
{
  "Contents": [
    {
      "Key": "config/env-settings",
      "LastModified": "2024-12-25T12:59:10.000Z",
      "ETag": "\"c2aab1ab21f660fc58c29461ed04fec4\"",
      "Size": 120,
      "StorageClass": "STANDARD",
      "Owner": {
        "DisplayName": "webfile",
        "ID": "75aa57f09aa0c8caeab4f8c24e99d10f8e7faeebf76c078efc7c6caea54ba06a"
      }
    },
    {
      "Key": "legal/license",
      "LastModified": "2024-12-25T12:59:33.000Z",
      "ETag": "\"1ebbd3e34237af26da5dc08a4e440464\"",
      "Size": 35149,
      "StorageClass": "STANDARD",
      "Owner": {
        "DisplayName": "webfile",
        "ID": "75aa57f09aa0c8caeab4f8c24e99d10f8e7faeebf76c078efc7c6caea54ba06a"
      }
    }
  ]
}
```

### 3. URL Generation and Access

#### Generate Pre-signed URLs

Create a temporary access URL for an object:

```bash
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3 presign s3://my-app-storage/config/env-settings
```

**Expected Response:**
```bash
http://localhost:4566/my-app-storage/config/env-settings?AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&Signature=cYUyEPyJ0RDq0RElUIifAkWFjZ0%3D&Expires=1729453882
```

#### Access Objects via HTTP

Retrieve object content using the pre-signed URL:

```bash
curl "http://localhost:4566/my-app-storage/config/env-settings"
```

**Expected Response:**
```bash
FIRST_QUEUE_NAME=first-queue
SECOND_QUEUE_NAME=second-queue
THIRD_QUEUE_NAME=third-queue
SOME_QUEUE_NAME_WITHOUT_VALUE=

FIRST_BUCKET_NAME=first-bucket
SECOND_BUCKET_NAME=second-bucket

FIRST_TOPIC_NAME=first-topic

FIRST_TOPIC_SUBSCRIPTION=first-topic|first-queue|{ "eventType": ["first-event"] }
SECOND_TOPIC_SUBSCRIPTION=first-topic|second-queue|{ "eventType": ["second-event"] }
THIRD_TOPIC_SUBSCRIPTION=first-topic|third-queue
```

## ‚ö†Ô∏è Important Notes

### Case Sensitivity

S3 object keys are **case-sensitive**. Pay attention to the exact key name when accessing objects:

- ‚úÖ Correct: `curl http://localhost:4566/my-app-storage/legal/license`
- ‚ùå Incorrect: `curl http://localhost:4566/my-app-storage/legal/LICENSE`

**Error Response for Incorrect Key:**
```xml
<Error>
    <Code>NoSuchKey</Code>
    <Message>The specified key does not exist.</Message>
    <RequestId>99fc9de8-9750-4017-9b5e-749d3757cb5c</RequestId>
    <Key>LICENSE</Key>
</Error>
```

## üîß Advanced Operations


### Batch Operations

Upload multiple files:

```bash
# Upload all files from a directory
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3 cp ./config/ s3://my-app-storage/config/ --recursive

# Sync local directory with S3 bucket
aws --endpoint-url=http://localhost:4566 --region us-east-1 s3 sync ./data/ s3://my-app-storage/data/
```

## üìö Additional Resources

- [AWS S3 Documentation](https://docs.aws.amazon.com/s3/)
- [LocalStack S3 Guide](https://docs.localstack.cloud/user-guide/aws/s3/)
- [S3 Best Practices](https://docs.aws.amazon.com/s3/latest/userguide/optimizing-performance.html)
